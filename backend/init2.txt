--
-- PostgreSQL database dump
-- ticket_system 데이터베이스 전체 덤프 파일
-- 
-- 실행 방법:
-- 1. PostgreSQL 서비스 시작
-- 2. 새 데이터베이스 생성: CREATE DATABASE ticket_system;
-- 3. 덤프 파일 실행: psql -U postgres -d ticket_system -f ticket_system_dump.sql
--

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- 1. 확장 기능 생성
--

CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA public;
COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';

CREATE EXTENSION IF NOT EXISTS "pgcrypto" WITH SCHEMA public;
COMMENT ON EXTENSION "pgcrypto" IS 'cryptographic functions';

SET default_tablespace = '';
SET default_table_access_method = heap;

--
-- 2. 공통 함수 생성
--

CREATE OR REPLACE FUNCTION public.update_updated_at_column()
    RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$;

--
-- 3. 테이블 스키마 생성
--

--
-- 슈퍼 관리자 테이블
--

CREATE TABLE public.super_admins (
    id integer NOT NULL,
    username character varying(50) NOT NULL,
    email character varying(100) NOT NULL,
    password_hash character varying(255) NOT NULL,
    full_name character varying(100) NOT NULL,
    is_active boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);

CREATE SEQUENCE public.super_admins_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.super_admins_id_seq OWNED BY public.super_admins.id;
ALTER TABLE ONLY public.super_admins ALTER COLUMN id SET DEFAULT nextval('public.super_admins_id_seq'::regclass);

--
-- 이벤트 테이블
--

CREATE TABLE public.events (
    id integer NOT NULL,
    event_code character varying(20) NOT NULL,
    title character varying(200) NOT NULL,
    description text,
    image_url character varying(500),
    start_date date NOT NULL,
    end_date date NOT NULL,
    is_active boolean DEFAULT true,
    is_deleted character(1) DEFAULT 'N'::bpchar,
    created_by integer,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_events_date_range CHECK ((end_date >= start_date)),
    CONSTRAINT chk_events_is_deleted CHECK ((is_deleted = ANY (ARRAY['Y'::bpchar, 'N'::bpchar])))
);

CREATE SEQUENCE public.events_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.events_id_seq OWNED BY public.events.id;
ALTER TABLE ONLY public.events ALTER COLUMN id SET DEFAULT nextval('public.events_id_seq'::regclass);

--
-- 이벤트 관리자 테이블
--

CREATE TABLE public.event_managers (
    id integer NOT NULL,
    event_id integer NOT NULL,
    username character varying(50) NOT NULL,
    email character varying(100) NOT NULL,
    password_hash character varying(255) NOT NULL,
    full_name character varying(100) NOT NULL,
    permission_level integer DEFAULT 2,
    is_active boolean DEFAULT true,
    is_deleted character(1) DEFAULT 'N'::bpchar,
    created_by integer,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_event_managers_is_deleted CHECK ((is_deleted = ANY (ARRAY['Y'::bpchar, 'N'::bpchar]))),
    CONSTRAINT chk_event_managers_permission CHECK (((permission_level >= 1) AND (permission_level <= 9)))
);

CREATE SEQUENCE public.event_managers_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.event_managers_id_seq OWNED BY public.event_managers.id;
ALTER TABLE ONLY public.event_managers ALTER COLUMN id SET DEFAULT nextval('public.event_managers_id_seq'::regclass);

COMMENT ON COLUMN public.event_managers.permission_level IS '1:조회전용, 2:일반관리자, 3:담당자, 9:슈퍼관리자';

--
-- 고객 테이블
--

CREATE TABLE public.customers (
    id integer NOT NULL,
    name character varying(100) NOT NULL,
    phone character varying(20) NOT NULL,
    email character varying(100),
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);

CREATE SEQUENCE public.customers_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.customers_id_seq OWNED BY public.customers.id;
ALTER TABLE ONLY public.customers ALTER COLUMN id SET DEFAULT nextval('public.customers_id_seq'::regclass);

--
-- 상품 테이블
--

CREATE TABLE public.products (
    id integer NOT NULL,
    event_id integer NOT NULL,
    name character varying(200) NOT NULL,
    description text,
    base_price numeric(10,2) NOT NULL,
    base_stock integer DEFAULT 0 NOT NULL,
    current_stock integer DEFAULT 0 NOT NULL,
    is_active boolean DEFAULT true,
    is_deleted character(1) DEFAULT 'N'::bpchar,
    created_by integer NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_products_is_deleted CHECK ((is_deleted = ANY (ARRAY['Y'::bpchar, 'N'::bpchar]))),
    CONSTRAINT chk_products_price_positive CHECK ((base_price >= (0)::numeric)),
    CONSTRAINT chk_products_stock_non_negative CHECK (((base_stock >= 0) AND (current_stock >= 0)))
);

CREATE SEQUENCE public.products_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.products_id_seq OWNED BY public.products.id;
ALTER TABLE ONLY public.products ALTER COLUMN id SET DEFAULT nextval('public.products_id_seq'::regclass);

--
-- 상품 옵션 테이블
--

CREATE TABLE public.product_options (
    id integer NOT NULL,
    product_id integer NOT NULL,
    option_name character varying(100) NOT NULL,
    price_adjustment numeric(10,2) DEFAULT 0,
    stock_quantity integer DEFAULT 0 NOT NULL,
    current_stock integer DEFAULT 0 NOT NULL,
    is_active boolean DEFAULT true,
    is_deleted character(1) DEFAULT 'N'::bpchar,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_product_options_is_deleted CHECK ((is_deleted = ANY (ARRAY['Y'::bpchar, 'N'::bpchar]))),
    CONSTRAINT chk_product_options_stock_non_negative CHECK (((stock_quantity >= 0) AND (current_stock >= 0)))
);

CREATE SEQUENCE public.product_options_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.product_options_id_seq OWNED BY public.product_options.id;
ALTER TABLE ONLY public.product_options ALTER COLUMN id SET DEFAULT nextval('public.product_options_id_seq'::regclass);

--
-- 주문 테이블
--

CREATE TABLE public.orders (
    id integer NOT NULL,
    event_id integer NOT NULL,
    customer_id integer NOT NULL,
    order_number character varying(50) NOT NULL,
    total_amount numeric(10,2) NOT NULL,
    status character varying(20) DEFAULT 'pending'::character varying,
    visit_date date NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_orders_amount_positive CHECK ((total_amount >= (0)::numeric)),
    CONSTRAINT chk_orders_status CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'paid'::character varying, 'cancelled'::character varying, 'refunded'::character varying])::text[])))
);

CREATE SEQUENCE public.orders_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.orders_id_seq OWNED BY public.orders.id;
ALTER TABLE ONLY public.orders ALTER COLUMN id SET DEFAULT nextval('public.orders_id_seq'::regclass);

--
-- 주문 상품 테이블
--

CREATE TABLE public.order_items (
    id integer NOT NULL,
    order_id integer NOT NULL,
    product_id integer NOT NULL,
    product_option_id integer,
    item_name character varying(200) NOT NULL,
    quantity integer NOT NULL,
    unit_price numeric(10,2) NOT NULL,
    total_price numeric(10,2) NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_order_items_price_positive CHECK (((unit_price >= (0)::numeric) AND (total_price >= (0)::numeric))),
    CONSTRAINT chk_order_items_quantity_positive CHECK ((quantity > 0))
);

CREATE SEQUENCE public.order_items_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.order_items_id_seq OWNED BY public.order_items.id;
ALTER TABLE ONLY public.order_items ALTER COLUMN id SET DEFAULT nextval('public.order_items_id_seq'::regclass);

--
-- 결제 테이블
--

CREATE TABLE public.payments (
    id integer NOT NULL,
    order_id integer NOT NULL,
    payment_key character varying(100) NOT NULL,
    payment_method character varying(50) NOT NULL,
    amount numeric(10,2) NOT NULL,
    status character varying(20) DEFAULT 'pending'::character varying,
    toss_payment_id character varying(100),
    payment_data jsonb,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_payments_amount_positive CHECK ((amount >= (0)::numeric)),
    CONSTRAINT chk_payments_status CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'success'::character varying, 'failed'::character varying, 'cancelled'::character varying])::text[])))
);

CREATE SEQUENCE public.payments_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.payments_id_seq OWNED BY public.payments.id;
ALTER TABLE ONLY public.payments ALTER COLUMN id SET DEFAULT nextval('public.payments_id_seq'::regclass);

--
-- QR 티켓 테이블
--

CREATE TABLE public.qr_tickets (
    id integer NOT NULL,
    order_id integer NOT NULL,
    order_item_id integer NOT NULL,
    qr_code character varying(100) NOT NULL,
    ticket_type character varying(50) NOT NULL,
    is_used boolean DEFAULT false,
    used_at timestamp without time zone,
    used_by integer,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);

CREATE SEQUENCE public.qr_tickets_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.qr_tickets_id_seq OWNED BY public.qr_tickets.id;
ALTER TABLE ONLY public.qr_tickets ALTER COLUMN id SET DEFAULT nextval('public.qr_tickets_id_seq'::regclass);

--
-- 공지사항 테이블
--

CREATE TABLE public.notices (
    id integer NOT NULL,
    event_id integer NOT NULL,
    title character varying(300) NOT NULL,
    content text NOT NULL,
    is_pinned boolean DEFAULT false,
    is_active boolean DEFAULT true,
    created_by integer NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);

CREATE SEQUENCE public.notices_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.notices_id_seq OWNED BY public.notices.id;
ALTER TABLE ONLY public.notices ALTER COLUMN id SET DEFAULT nextval('public.notices_id_seq'::regclass);

--
-- 공지사항 첨부파일 테이블
--

CREATE TABLE public.notice_files (
    id integer NOT NULL,
    notice_id integer NOT NULL,
    original_filename character varying(255) NOT NULL,
    stored_filename character varying(255) NOT NULL,
    file_path character varying(500) NOT NULL,
    file_size integer NOT NULL,
    content_type character varying(100) NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_notice_files_size_positive CHECK ((file_size > 0))
);

CREATE SEQUENCE public.notice_files_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.notice_files_id_seq OWNED BY public.notice_files.id;
ALTER TABLE ONLY public.notice_files ALTER COLUMN id SET DEFAULT nextval('public.notice_files_id_seq'::regclass);

--
-- 입장 로그 테이블
--

CREATE TABLE public.entrance_logs (
    id integer NOT NULL,
    qr_ticket_id integer NOT NULL,
    processed_by integer NOT NULL,
    entrance_type character varying(20) DEFAULT 'normal'::character varying,
    device_info text,
    processed_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_entrance_logs_entrance_type CHECK (((entrance_type)::text = ANY ((ARRAY['normal'::character varying, 'invitation'::character varying])::text[])))
);

CREATE SEQUENCE public.entrance_logs_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.entrance_logs_id_seq OWNED BY public.entrance_logs.id;
ALTER TABLE ONLY public.entrance_logs ALTER COLUMN id SET DEFAULT nextval('public.entrance_logs_id_seq'::regclass);

--
-- 관리자 활동 로그 테이블 (파티셔닝)
--

CREATE TABLE public.admin_activity_logs (
    id integer NOT NULL,
    admin_id integer NOT NULL,
    event_id integer,
    admin_type character varying(20) NOT NULL,
    action_type character varying(50) NOT NULL,
    target_table character varying(50),
    target_id integer,
    old_data jsonb,
    new_data jsonb,
    ip_address inet,
    user_agent text,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_admin_activity_logs_admin_type CHECK (((admin_type)::text = ANY ((ARRAY['super_admin'::character varying, 'event_manager'::character varying])::text[])))
) PARTITION BY RANGE (created_at);

CREATE SEQUENCE public.admin_activity_logs_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE public.admin_activity_logs_id_seq OWNED BY public.admin_activity_logs.id;
ALTER TABLE ONLY public.admin_activity_logs ALTER COLUMN id SET DEFAULT nextval('public.admin_activity_logs_id_seq'::regclass);

--
-- 2025년 월별 파티션 생성
--

CREATE TABLE public.admin_activity_logs_y2025m07 PARTITION OF public.admin_activity_logs
    FOR VALUES FROM ('2025-07-01 00:00:00') TO ('2025-08-01 00:00:00');

CREATE TABLE public.admin_activity_logs_y2025m08 PARTITION OF public.admin_activity_logs
    FOR VALUES FROM ('2025-08-01 00:00:00') TO ('2025-09-01 00:00:00');

CREATE TABLE public.admin_activity_logs_y2025m09 PARTITION OF public.admin_activity_logs
    FOR VALUES FROM ('2025-09-01 00:00:00') TO ('2025-10-01 00:00:00');

CREATE TABLE public.admin_activity_logs_y2025m10 PARTITION OF public.admin_activity_logs
    FOR VALUES FROM ('2025-10-01 00:00:00') TO ('2025-11-01 00:00:00');

CREATE TABLE public.admin_activity_logs_y2025m11 PARTITION OF public.admin_activity_logs
    FOR VALUES FROM ('2025-11-01 00:00:00') TO ('2025-12-01 00:00:00');

CREATE TABLE public.admin_activity_logs_y2025m12 PARTITION OF public.admin_activity_logs
    FOR VALUES FROM ('2025-12-01 00:00:00') TO ('2026-01-01 00:00:00');

--
-- 4. 기본키 및 제약조건 설정
--

ALTER TABLE ONLY public.super_admins
    ADD CONSTRAINT super_admins_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.super_admins
    ADD CONSTRAINT super_admins_username_key UNIQUE (username);

ALTER TABLE ONLY public.super_admins
    ADD CONSTRAINT super_admins_email_key UNIQUE (email);

ALTER TABLE ONLY public.events
    ADD CONSTRAINT events_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.event_managers
    ADD CONSTRAINT event_managers_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.customers
    ADD CONSTRAINT customers_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.customers
    ADD CONSTRAINT customers_phone_key UNIQUE (phone);

ALTER TABLE ONLY public.products
    ADD CONSTRAINT products_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.product_options
    ADD CONSTRAINT product_options_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.orders
    ADD CONSTRAINT orders_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.orders
    ADD CONSTRAINT orders_order_number_key UNIQUE (order_number);

ALTER TABLE ONLY public.order_items
    ADD CONSTRAINT order_items_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_payment_key_key UNIQUE (payment_key);

ALTER TABLE ONLY public.qr_tickets
    ADD CONSTRAINT qr_tickets_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.qr_tickets
    ADD CONSTRAINT qr_tickets_qr_code_key UNIQUE (qr_code);

ALTER TABLE ONLY public.notices
    ADD CONSTRAINT notices_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.notice_files
    ADD CONSTRAINT notice_files_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.entrance_logs
    ADD CONSTRAINT entrance_logs_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.admin_activity_logs
    ADD CONSTRAINT admin_activity_logs_pkey PRIMARY KEY (id, created_at);

--
-- 5. 인덱스 생성
--

CREATE INDEX idx_super_admins_username ON public.super_admins USING btree (username);
CREATE INDEX idx_super_admins_email ON public.super_admins USING btree (email);
CREATE INDEX idx_super_admins_active ON public.super_admins USING btree (is_active);

CREATE UNIQUE INDEX idx_events_code_active ON public.events USING btree (event_code) WHERE (is_deleted = 'N'::bpchar);
CREATE INDEX idx_events_active ON public.events USING btree (is_active, is_deleted);
CREATE INDEX idx_events_date_range ON public.events USING btree (start_date, end_date);
CREATE INDEX idx_events_created_by ON public.events USING btree (created_by);

CREATE UNIQUE INDEX idx_event_managers_username_active ON public.event_managers USING btree (username) WHERE (is_deleted = 'N'::bpchar);
CREATE UNIQUE INDEX idx_event_managers_email_active ON public.event_managers USING btree (email) WHERE (is_deleted = 'N'::bpchar);
CREATE INDEX idx_event_managers_event ON public.event_managers USING btree (event_id, is_deleted);
CREATE INDEX idx_event_managers_permission ON public.event_managers USING btree (permission_level);
CREATE INDEX idx_event_managers_active ON public.event_managers USING btree (is_active, is_deleted);

CREATE UNIQUE INDEX idx_customers_phone ON public.customers USING btree (phone);
CREATE INDEX idx_customers_email ON public.customers USING btree (email);
CREATE INDEX idx_customers_name ON public.customers USING btree (name);

CREATE INDEX idx_products_event ON public.products USING btree (event_id, is_deleted);
CREATE INDEX idx_products_active ON public.products USING btree (is_active, is_deleted);
CREATE INDEX idx_products_stock ON public.products USING btree (current_stock);
CREATE INDEX idx_products_created_by ON public.products USING btree (created_by);
CREATE INDEX idx_products_event_active_stock ON public.products USING btree (event_id, is_active, is_deleted, current_stock);

CREATE INDEX idx_product_options_product ON public.product_options USING btree (product_id, is_deleted);
CREATE INDEX idx_product_options_active ON public.product_options USING btree (is_active, is_deleted);
CREATE INDEX idx_product_options_stock ON public.product_options USING btree (current_stock);
CREATE INDEX idx_product_options_product_active_stock ON public.product_options USING btree (product_id, is_active, is_deleted, current_stock);

CREATE UNIQUE INDEX idx_orders_order_number ON public.orders USING btree (order_number);
CREATE INDEX idx_orders_event ON public.orders USING btree (event_id);
CREATE INDEX idx_orders_customer ON public.orders USING btree (customer_id);
CREATE INDEX idx_orders_status ON public.orders USING btree (status);
CREATE INDEX idx_orders_visit_date ON public.orders USING btree (visit_date);
CREATE INDEX idx_orders_created_at ON public.orders USING btree (created_at DESC);
CREATE INDEX idx_orders_event_status_date ON public.orders USING btree (event_id, status, visit_date DESC);

CREATE INDEX idx_order_items_order ON public.order_items USING btree (order_id);
CREATE INDEX idx_order_items_product ON public.order_items USING btree (product_id);
CREATE INDEX idx_order_items_option ON public.order_items USING btree (product_option_id);

CREATE UNIQUE INDEX idx_payments_payment_key ON public.payments USING btree (payment_key);
CREATE INDEX idx_payments_order ON public.payments USING btree (order_id);
CREATE INDEX idx_payments_status ON public.payments USING btree (status);
CREATE INDEX idx_payments_toss_id ON public.payments USING btree (toss_payment_id);
CREATE INDEX idx_payments_created_at ON public.payments USING btree (created_at DESC);

CREATE UNIQUE INDEX idx_qr_tickets_qr_code ON public.qr_tickets USING btree (qr_code);
CREATE INDEX idx_qr_tickets_order ON public.qr_tickets USING btree (order_id);
CREATE INDEX idx_qr_tickets_order_item ON public.qr_tickets USING btree (order_item_id);
CREATE INDEX idx_qr_tickets_used ON public.qr_tickets USING btree (is_used, used_at);
CREATE INDEX idx_qr_tickets_used_by ON public.qr_tickets USING btree (used_by);
CREATE INDEX idx_qr_tickets_order_used ON public.qr_tickets USING btree (order_id, is_used, used_at);

CREATE INDEX idx_notices_event ON public.notices USING btree (event_id, is_active);
CREATE INDEX idx_notices_pinned ON public.notices USING btree (is_pinned, is_active);
CREATE INDEX idx_notices_created_by ON public.notices USING btree (created_by);
CREATE INDEX idx_notices_created_at ON public.notices USING btree (created_at DESC);

CREATE INDEX idx_notice_files_notice ON public.notice_files USING btree (notice_id);
CREATE INDEX idx_notice_files_stored_filename ON public.notice_files USING btree (stored_filename);

CREATE INDEX idx_entrance_logs_qr_ticket ON public.entrance_logs USING btree (qr_ticket_id);
CREATE INDEX idx_entrance_logs_processed_by ON public.entrance_logs USING btree (processed_by);
CREATE INDEX idx_entrance_logs_processed_at ON public.entrance_logs USING btree (processed_at DESC);
CREATE INDEX idx_entrance_logs_entrance_type ON public.entrance_logs USING btree (entrance_type);

CREATE INDEX idx_admin_activity_logs_admin ON public.admin_activity_logs USING btree (admin_id, admin_type);
CREATE INDEX idx_admin_activity_logs_event ON public.admin_activity_logs USING btree (event_id);
CREATE INDEX idx_admin_activity_logs_action ON public.admin_activity_logs USING btree (action_type);
CREATE INDEX idx_admin_activity_logs_created_at ON public.admin_activity_logs USING btree (created_at DESC);
CREATE INDEX idx_admin_activity_logs_target ON public.admin_activity_logs USING btree (target_table, target_id);
CREATE INDEX idx_admin_activity_logs_event_admin_date ON public.admin_activity_logs USING btree (event_id, admin_id, created_at DESC);

--
-- 6. 트리거 생성
--

CREATE TRIGGER update_super_admins_updated_at BEFORE UPDATE ON public.super_admins FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();
CREATE TRIGGER update_events_updated_at BEFORE UPDATE ON public.events FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();
CREATE TRIGGER update_event_managers_updated_at BEFORE UPDATE ON public.event_managers FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();
CREATE TRIGGER update_customers_updated_at BEFORE UPDATE ON public.customers FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();
CREATE TRIGGER update_products_updated_at BEFORE UPDATE ON public.products FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();
CREATE TRIGGER update_product_options_updated_at BEFORE UPDATE ON public.product_options FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();
CREATE TRIGGER update_orders_updated_at BEFORE UPDATE ON public.orders FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();
CREATE TRIGGER update_payments_updated_at BEFORE UPDATE ON public.payments FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();
CREATE TRIGGER update_qr_tickets_updated_at BEFORE UPDATE ON public.qr_tickets FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();
CREATE TRIGGER update_notices_updated_at BEFORE UPDATE ON public.notices FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();

--
-- 7. 외래키 제약조건 생성
--

ALTER TABLE ONLY public.events
    ADD CONSTRAINT events_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.super_admins(id);

ALTER TABLE ONLY public.event_managers
    ADD CONSTRAINT event_managers_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.events(id);

ALTER TABLE ONLY public.event_managers
    ADD CONSTRAINT event_managers_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.super_admins(id);

ALTER TABLE ONLY public.products
    ADD CONSTRAINT products_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.events(id);

ALTER TABLE ONLY public.product_options
    ADD CONSTRAINT product_options_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id);

ALTER TABLE ONLY public.orders
    ADD CONSTRAINT orders_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.events(id);

ALTER TABLE ONLY public.orders
    ADD CONSTRAINT orders_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id);

ALTER TABLE ONLY public.order_items
    ADD CONSTRAINT order_items_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id);

ALTER TABLE ONLY public.order_items
    ADD CONSTRAINT order_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id);

ALTER TABLE ONLY public.order_items
    ADD CONSTRAINT order_items_product_option_id_fkey FOREIGN KEY (product_option_id) REFERENCES public.product_options(id);

ALTER TABLE ONLY public.payments
    ADD CONSTRAINT payments_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id);

ALTER TABLE ONLY public.qr_tickets
    ADD CONSTRAINT qr_tickets_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id);

ALTER TABLE ONLY public.qr_tickets
    ADD CONSTRAINT qr_tickets_order_item_id_fkey FOREIGN KEY (order_item_id) REFERENCES public.order_items(id);

ALTER TABLE ONLY public.notices
    ADD CONSTRAINT notices_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.events(id);

ALTER TABLE ONLY public.notice_files
    ADD CONSTRAINT notice_files_notice_id_fkey FOREIGN KEY (notice_id) REFERENCES public.notices(id) ON DELETE CASCADE;

ALTER TABLE ONLY public.entrance_logs
    ADD CONSTRAINT entrance_logs_qr_ticket_id_fkey FOREIGN KEY (qr_ticket_id) REFERENCES public.qr_tickets(id);

--
-- 8. 초기 데이터 삽입
--

-- 슈퍼 관리자 계정
INSERT INTO public.super_admins (id, username, email, password_hash, full_name, is_active, created_at, updated_at) VALUES
(1, 'superadmin', 'super@ticket-system.com', '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewEyKZZZNGfwpSre', '시스템 슈퍼 관리자', true, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(2, 'admin', 'admin@ticket-system.com', '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewEyKZZZNGfwpSre', '시스템 운영 관리자', true, '2025-07-25 10:00:00', '2025-07-25 10:00:00');

-- 이벤트 데이터
INSERT INTO public.events (id, event_code, title, description, start_date, end_date, is_active, is_deleted, created_by, created_at, updated_at) VALUES
(1, 'AAA', '서울 아트 페어 2025', '2025년 서울에서 열리는 대규모 아트 페어입니다. 국내외 유명 아티스트들의 작품을 만나보세요.', '2025-08-01', '2025-08-10', true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(2, 'BBB', '부산 음악 축제 2025', '2025년 부산에서 열리는 K-POP 음악 축제입니다. 최고의 아티스트들과 함께하는 특별한 시간!', '2025-09-15', '2025-09-17', true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(3, 'CCC', '대구 푸드 페스티벌 2025', '2025년 대구 특색 음식 축제입니다. 대구 지역 최고의 맛집들이 한자리에!', '2025-10-05', '2025-10-07', true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00');

-- 이벤트 관리자 계정
INSERT INTO public.event_managers (id, event_id, username, email, password_hash, full_name, permission_level, is_active, is_deleted, created_by, created_at, updated_at) VALUES
(1, 1, 'manager_aaa', 'manager.aaa@ticket-system.com', '$2b$12$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'AAA 이벤트 담당자', 3, true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(2, 2, 'manager_bbb', 'manager.bbb@ticket-system.com', '$2b$12$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'BBB 이벤트 담당자', 3, true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(3, 3, 'manager_ccc', 'manager.ccc@ticket-system.com', '$2b$12$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'CCC 이벤트 담당자', 3, true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(4, 1, 'staff_aaa_1', 'staff1.aaa@ticket-system.com', '$2b$12$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'AAA 이벤트 스태프 1', 2, true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(5, 1, 'staff_aaa_2', 'staff2.aaa@ticket-system.com', '$2b$12$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'AAA 이벤트 스태프 2', 2, true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(6, 2, 'viewer_bbb', 'viewer.bbb@ticket-system.com', '$2b$12$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'BBB 이벤트 조회자', 1, true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00');

-- 상품 데이터
INSERT INTO public.products (id, event_id, name, description, base_price, base_stock, current_stock, is_active, is_deleted, created_by, created_at, updated_at) VALUES
(1, 1, 'AAA 일반 입장권', '서울 아트 페어 일반 입장권 - 모든 전시관 자유 관람', 25000, 5000, 5000, true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(2, 1, 'AAA VIP 입장권', '서울 아트 페어 VIP 입장권 - 전용 라운지 이용 가능 + 도슨트 투어', 50000, 500, 500, true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(3, 1, 'AAA 학생 할인권', '서울 아트 페어 학생 할인 입장권 - 학생증 지참 필수', 15000, 1000, 1000, true, 'N', 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(4, 2, 'BBB 1일권', '부산 음악 축제 1일 입장권 - 선택한 날짜만 입장 가능', 80000, 10000, 10000, true, 'N', 2, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(5, 2, 'BBB 3일권', '부산 음악 축제 3일 패키지 입장권 - 전 기간 자유 입장', 200000, 3000, 3000, true, 'N', 2, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(6, 2, 'BBB VIP 패키지', '부산 음악 축제 VIP 패키지 - 전용 구역 + 아티스트 미트앤그릿', 500000, 200, 200, true, 'N', 2, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(7, 3, 'CCC 일반권', '대구 푸드 페스티벌 일반 입장권 - 기본 시식 3회 포함', 15000, 8000, 8000, true, 'N', 3, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(8, 3, 'CCC 시식권', '대구 푸드 페스티벌 시식 체험권 - 무제한 시식 + 레시피북', 30000, 2000, 2000, true, 'N', 3, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(9, 3, 'CCC 쿠킹클래스', '대구 푸드 페스티벌 쿠킹클래스 - 셰프와 함께하는 요리 체험', 50000, 100, 100, true, 'N', 3, '2025-07-25 10:00:00', '2025-07-25 10:00:00');

-- 상품 옵션 데이터
INSERT INTO public.product_options (id, product_id, option_name, price_adjustment, stock_quantity, current_stock, is_active, is_deleted, created_at, updated_at) VALUES
(1, 1, '성인', 0, 3000, 3000, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(2, 1, '청소년', -5000, 1000, 1000, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(3, 1, '어린이', -10000, 1000, 1000, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(4, 2, '성인', 0, 400, 400, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(5, 2, '청소년', -10000, 100, 100, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(6, 3, '대학생', 0, 700, 700, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(7, 3, '고등학생', -3000, 300, 300, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(8, 4, '성인', 0, 6000, 6000, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(9, 4, '청소년', -20000, 2000, 2000, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(10, 4, '어린이', -30000, 2000, 2000, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(11, 5, '성인', 0, 2000, 2000, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(12, 5, '청소년', -50000, 1000, 1000, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(13, 6, '성인', 0, 150, 150, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(14, 6, '청소년', -100000, 50, 50, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(15, 7, '성인', 0, 5000, 5000, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(16, 7, '청소년', -3000, 1500, 1500, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(17, 7, '어린이', -5000, 1500, 1500, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(18, 8, '성인', 0, 1500, 1500, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(19, 8, '청소년', -5000, 500, 500, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(20, 9, '성인', 0, 80, 80, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(21, 9, '청소년', -10000, 20, 20, true, 'N', '2025-07-25 10:00:00', '2025-07-25 10:00:00');

-- 테스트 고객 데이터
INSERT INTO public.customers (id, name, phone, email, created_at, updated_at) VALUES
(1, '김철수', '010-1234-5678', 'kim.cs@example.com', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(2, '이영희', '010-2345-6789', 'lee.yh@example.com', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(3, '박민수', '010-3456-7890', 'park.ms@example.com', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(4, '정수연', '010-4567-8901', 'jung.sy@example.com', '2025-07-25 10:00:00', '2025-07-25 10:00:00'),
(5, '최지훈', '010-5678-9012', 'choi.jh@example.com', '2025-07-25 10:00:00', '2025-07-25 10:00:00');

-- 테스트 주문 데이터
INSERT INTO public.orders (id, event_id, customer_id, order_number, total_amount, status, visit_date, created_at, updated_at) VALUES
(1, 1, 1, 'ORD20250725001', 65000, 'paid', '2025-08-05', '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(2, 1, 2, 'ORD20250725002', 40000, 'paid', '2025-08-06', '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(3, 2, 3, 'ORD20250725003', 160000, 'paid', '2025-09-15', '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(4, 3, 4, 'ORD20250725004', 27000, 'pending', '2025-10-05', '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(5, 1, 5, 'ORD20250725005', 50000, 'paid', '2025-08-07', '2025-07-25 11:00:00', '2025-07-25 11:00:00');

-- 테스트 주문 상품 데이터
INSERT INTO public.order_items (id, order_id, product_id, product_option_id, item_name, quantity, unit_price, total_price, created_at) VALUES
(1, 1, 1, 1, 'AAA 일반 입장권 (성인)', 2, 25000, 50000, '2025-07-25 11:00:00'),
(2, 1, 1, 3, 'AAA 일반 입장권 (어린이)', 1, 15000, 15000, '2025-07-25 11:00:00'),
(3, 2, 1, 2, 'AAA 일반 입장권 (청소년)', 2, 20000, 40000, '2025-07-25 11:00:00'),
(4, 3, 4, 8, 'BBB 1일권 (성인)', 2, 80000, 160000, '2025-07-25 11:00:00'),
(5, 4, 7, 15, 'CCC 일반권 (성인)', 1, 15000, 15000, '2025-07-25 11:00:00'),
(6, 4, 7, 16, 'CCC 일반권 (청소년)', 1, 12000, 12000, '2025-07-25 11:00:00'),
(7, 5, 2, 4, 'AAA VIP 입장권 (성인)', 1, 50000, 50000, '2025-07-25 11:00:00');

-- 테스트 결제 데이터
INSERT INTO public.payments (id, order_id, payment_key, payment_method, amount, status, toss_payment_id, created_at, updated_at) VALUES
(1, 1, 'PAY_kim_20250725_001', 'card', 65000, 'success', 'toss_pay_12345', '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(2, 2, 'PAY_lee_20250725_002', 'card', 40000, 'success', 'toss_pay_12346', '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(3, 3, 'PAY_park_20250725_003', 'card', 160000, 'success', 'toss_pay_12347', '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(4, 4, 'PAY_jung_20250725_004', 'card', 27000, 'pending', 'toss_pay_12348', '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(5, 5, 'PAY_choi_20250725_005', 'card', 50000, 'success', 'toss_pay_12349', '2025-07-25 11:00:00', '2025-07-25 11:00:00');

-- 테스트 QR 티켓 데이터
INSERT INTO public.qr_tickets (id, order_id, order_item_id, qr_code, ticket_type, is_used, used_at, used_by, created_at, updated_at) VALUES
(1, 1, 1, 'QR_AAA_20250725_001_1', '성인', true, '2025-08-05 10:30:00', 1, '2025-07-25 11:00:00', '2025-08-05 10:30:00'),
(2, 1, 1, 'QR_AAA_20250725_001_2', '성인', true, '2025-08-05 10:30:00', 1, '2025-07-25 11:00:00', '2025-08-05 10:30:00'),
(3, 1, 2, 'QR_AAA_20250725_001_3', '어린이', true, '2025-08-05 10:30:00', 1, '2025-07-25 11:00:00', '2025-08-05 10:30:00'),
(4, 2, 3, 'QR_AAA_20250725_002_1', '청소년', false, NULL, NULL, '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(5, 2, 3, 'QR_AAA_20250725_002_2', '청소년', false, NULL, NULL, '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(6, 3, 4, 'QR_BBB_20250725_003_1', '성인', false, NULL, NULL, '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(7, 3, 4, 'QR_BBB_20250725_003_2', '성인', false, NULL, NULL, '2025-07-25 11:00:00', '2025-07-25 11:00:00'),
(8, 5, 7, 'QR_AAA_20250725_005_1', '성인', false, NULL, NULL, '2025-07-25 11:00:00', '2025-07-25 11:00:00');

-- 테스트 공지사항 데이터
INSERT INTO public.notices (id, event_id, title, content, is_pinned, is_active, created_by, created_at, updated_at) VALUES
(1, 1, '[필독] 서울 아트 페어 2025 개최 안내', 
'올해로 5회째를 맞는 서울 아트 페어가 8월 1일부터 10일까지 코엑스에서 개최됩니다.

주요 일정:
- 오픈: 매일 오전 10시
- 마감: 평일 오후 8시, 주말 오후 9시
- 휴관: 없음 (전 기간 개방)

관람 안내:
- 전시관 총 4개동 (A, B, C, D동)
- 주차장 혼잡 예상으로 대중교통 이용 권장
- 관람 소요시간: 약 3-4시간

많은 관심과 참여 부탁드립니다.', true, true, 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),

(2, 1, '주차장 이용 안내', 
'행사 기간 중 주차장이 혼잡할 수 있습니다.

주차 정보:
- 요금: 시간당 3,000원
- 1일 최대: 15,000원
- 운영시간: 24시간

대중교통 이용을 적극 권장하며, 지하철 2호선 삼성역, 9호선 봉은사역에서 도보 5분 거리입니다.', false, true, 1, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),

(3, 2, '[라인업 공개] 부산 음악 축제 2025', 
'드디어 부산 음악 축제 2025 라인업을 공개합니다!

DAY 1 (9월 15일):
- 헤드라이너: BTS
- 서브 헤드라이너: 블랙핑크
- 특별 게스트: 뉴진스, 르세라핌

DAY 2 (9월 16일):
- 헤드라이너: 스트레이 키즈
- 서브 헤드라이너: (여자)아이들
- 특별 게스트: IVE, 에스파

DAY 3 (9월 17일):
- 헤드라이너: 세븐틴
- 서브 헤드라이너: 있지
- 특별 게스트: 아이브, 케플러

최고의 K-POP 아티스트들과 함께하는 특별한 3일간!', true, true, 2, '2025-07-25 10:00:00', '2025-07-25 10:00:00'),

(4, 3, '[참여 업체] 대구 푸드 페스티벌 맛집 라인업', 
'대구 지역 최고의 맛집들이 대거 참여합니다!

참여 업체 (총 52곳):
- 동인동 찜갈비 골목: 7개 업체
- 서문시장 먹거리: 12개 업체  
- 김광석 다시그리기길: 8개 업체
- 중구 카페거리: 15개 업체
- 대구 전통 음식: 10개 업체

특별 메뉴:
- 찜갈비 시식 세트 (3인분 20,000원)
- 동인동 막창 세트 (2인분 25,000원)
- 대구 10미 체험 코스 (1인 15,000원)

각 업체별 할인 혜택과 이벤트도 준비되어 있습니다!', true, true, 3, '2025-07-25 10:00:00', '2025-07-25 10:00:00');

-- 테스트 입장 로그 데이터
INSERT INTO public.entrance_logs (id, qr_ticket_id, processed_by, entrance_type, device_info, processed_at) VALUES
(1, 1, 1, 'normal', 'PWA Scanner v1.0 / iPhone 14 Pro', '2025-08-05 10:30:00'),
(2, 2, 1, 'normal', 'PWA Scanner v1.0 / iPhone 14 Pro', '2025-08-05 10:30:00'),
(3, 3, 1, 'normal', 'PWA Scanner v1.0 / iPhone 14 Pro', '2025-08-05 10:30:00');

-- 관리자 활동 로그 샘플 데이터
INSERT INTO public.admin_activity_logs (id, admin_id, event_id, admin_type, action_type, target_table, target_id, ip_address, created_at) VALUES
(1, 1, 1, 'super_admin', 'CREATE', 'events', 1, '192.168.1.100', '2025-07-25 10:00:00'),
(2, 1, 2, 'super_admin', 'CREATE', 'events', 2, '192.168.1.100', '2025-07-25 10:00:00'),
(3, 1, 3, 'super_admin', 'CREATE', 'events', 3, '192.168.1.100', '2025-07-25 10:00:00'),
(4, 1, 1, 'event_manager', 'LOGIN', NULL, NULL, '192.168.1.101', '2025-07-25 10:00:00'),
(5, 2, 2, 'event_manager', 'LOGIN', NULL, NULL, '192.168.1.102', '2025-07-25 10:00:00'),
(6, 1, 1, 'event_manager', 'CREATE', 'products', 1, '192.168.1.101', '2025-07-25 10:00:00'),
(7, 1, 1, 'event_manager', 'UPDATE', 'qr_tickets', 1, '192.168.1.101', '2025-08-05 10:30:00');

--
-- 9. 시퀀스 값 설정
--

SELECT pg_catalog.setval('public.super_admins_id_seq', 2, true);
SELECT pg_catalog.setval('public.events_id_seq', 3, true);
SELECT pg_catalog.setval('public.event_managers_id_seq', 6, true);
SELECT pg_catalog.setval('public.customers_id_seq', 5, true);
SELECT pg_catalog.setval('public.products_id_seq', 9, true);
SELECT pg_catalog.setval('public.product_options_id_seq', 21, true);
SELECT pg_catalog.setval('public.orders_id_seq', 5, true);
SELECT pg_catalog.setval('public.order_items_id_seq', 7, true);
SELECT pg_catalog.setval('public.payments_id_seq', 5, true);
SELECT pg_catalog.setval('public.qr_tickets_id_seq', 8, true);
SELECT pg_catalog.setval('public.notices_id_seq', 4, true);
SELECT pg_catalog.setval('public.notice_files_id_seq', 1, false);
SELECT pg_catalog.setval('public.entrance_logs_id_seq', 3, true);
SELECT pg_catalog.setval('public.admin_activity_logs_id_seq', 7, true);

--
-- 10. 통계 업데이트
--

ANALYZE public.super_admins;
ANALYZE public.events;
ANALYZE public.event_managers;
ANALYZE public.customers;
ANALYZE public.products;
ANALYZE public.product_options;
ANALYZE public.orders;
ANALYZE public.order_items;
ANALYZE public.payments;
ANALYZE public.qr_tickets;
ANALYZE public.notices;
ANALYZE public.notice_files;
ANALYZE public.entrance_logs;
ANALYZE public.admin_activity_logs;

--
-- 데이터베이스 생성 완료
--

SELECT 
    'ticket-system 데이터베이스 생성이 완료되었습니다.' as message,
    'PostgreSQL 덤프 파일 실행 성공!' as status,
    (SELECT COUNT(*) FROM public.events) as events_count,
    (SELECT COUNT(*) FROM public.event_managers) as managers_count,
    (SELECT COUNT(*) FROM public.products) as products_count,
    (SELECT COUNT(*) FROM public.orders) as orders_count,
    (SELECT COUNT(*) FROM public.qr_tickets) as tickets_count;